<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prism - 智能股票分析仪表盘</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f5f5;
            color: #333;
            overflow-x: hidden;
        }

        /* Header */
        .header {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            padding: 15px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .header-left {
            display: flex;
            align-items: center;
        }

        .logo {
            font-size: 1.8rem;
            font-weight: 700;
            margin-right: 30px;
        }

        .search-container {
            display: flex;
            align-items: center;
            background: rgba(255,255,255,0.2);
            border-radius: 25px;
            padding: 8px 20px;
            backdrop-filter: blur(10px);
        }

        .search-input {
            background: none;
            border: none;
            color: white;
            font-size: 1rem;
            outline: none;
            width: 200px;
            margin-right: 10px;
        }

        .search-input::placeholder {
            color: rgba(255,255,255,0.8);
        }

        .search-btn {
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            font-size: 1.1rem;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .refresh-btn {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .refresh-btn:hover {
            background: rgba(255,255,255,0.3);
        }

        /* Main Container */
        .container {
            max-width: 1800px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Dashboard Grid */
        .dashboard-grid {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr;
            grid-template-rows: auto auto auto;
            gap: 20px;
            margin-bottom: 20px;
        }

        /* Card Styles */
        .dashboard-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .dashboard-card:hover {
            box-shadow: 0 8px 25px rgba(0,0,0,0.12);
            transform: translateY(-2px);
        }

        .card-title {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 15px;
            color: #333;
            display: flex;
            align-items: center;
        }

        .card-title i {
            margin-right: 10px;
            color: #2a5298;
        }

        /* Price Card */
        .price-card {
            grid-column: 1;
            grid-row: 1;
        }

        .price-main {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
        }

        .current-price {
            font-size: 3rem;
            font-weight: 700;
            color: #2a5298;
        }

        .price-change {
            text-align: right;
        }

        .change-value {
            font-size: 1.5rem;
            font-weight: 600;
        }

        .change-percent {
            font-size: 1.2rem;
            margin-top: 5px;
        }

        .price-positive {
            color: #16c784;
        }

        .price-negative {
            color: #ea3943;
        }

        /* KPI Cards */
        .kpi-card {
            text-align: center;
        }

        .kpi-value {
            font-size: 2.5rem;
            font-weight: 700;
            color: #2a5298;
            margin-bottom: 10px;
        }

        .kpi-label {
            color: #666;
            font-size: 1rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .kpi-change {
            font-size: 0.9rem;
            margin-top: 5px;
        }

        /* Chart Container */
        .chart-container {
            height: 300px;
            position: relative;
        }

        .chart-large {
            height: 400px;
        }

        /* Volume Card */
        .volume-card {
            grid-column: 1;
            grid-row: 2;
        }

        /* Technical Cards */
        .market-cap-card {
            grid-column: 2;
            grid-row: 1;
        }

        .volume-ratio-card {
            grid-column: 3;
            grid-row: 1;
        }

        .sentiment-card {
            grid-column: 2;
            grid-row: 2;
        }

        .technical-card {
            grid-column: 3;
            grid-row: 2;
        }

        /* Financial Performance */
        .financial-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }

        .revenue-card, .profit-card {
            height: 350px;
        }

        /* AI Analysis */
        .ai-analysis {
            margin-top: 20px;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .ai-card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
        }

        .ai-professional {
            border-left: 5px solid #16c784;
        }

        .ai-dark {
            border-left: 5px solid #ea3943;
        }

        .ai-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }

        .ai-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5rem;
            margin-right: 15px;
        }

        .ai-professional .ai-avatar {
            background: #16c784;
        }

        .ai-dark .ai-avatar {
            background: #ea3943;
        }

        .ai-content {
            font-size: 1rem;
            line-height: 1.6;
            color: #555;
            margin-bottom: 15px;
        }

        .ai-summary {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            font-weight: 600;
            border-left: 4px solid #2a5298;
        }

        /* Loading States */
        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 200px;
            color: #666;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #2a5298;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Responsive */
        @media (max-width: 1400px) {
            .dashboard-grid {
                grid-template-columns: 1fr 1fr;
                grid-template-rows: auto auto auto auto;
            }

            .price-card {
                grid-column: 1 / -1;
            }

            .volume-card {
                grid-column: 1 / -1;
            }
        }

        @media (max-width: 768px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }

            .header {
                padding: 15px 20px;
                flex-direction: column;
                gap: 15px;
            }

            .search-input {
                width: 150px;
            }

            .ai-analysis {
                grid-template-columns: 1fr;
            }

            .financial-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Status Indicators */
        .status-indicator {
            display: inline-flex;
            align-items: center;
            padding: 4px 10px;
            border-radius: 15px;
            font-size: 0.9rem;
            font-weight: 600;
        }

        .status-positive {
            background: rgba(22, 199, 132, 0.1);
            color: #16c784;
        }

        .status-negative {
            background: rgba(234, 57, 67, 0.1);
            color: #ea3943;
        }

        .status-neutral {
            background: rgba(255, 193, 7, 0.1);
            color: #ffc107;
        }

        .trend-arrow {
            margin-left: 5px;
        }

        /* Error States */
        .error-card {
            background: #fff5f5;
            border: 1px solid #fed7d7;
            color: #c53030;
            text-align: center;
            padding: 40px 20px;
        }

        .error-icon {
            font-size: 3rem;
            margin-bottom: 15px;
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="header-left">
            <div class="logo">
                <i class="fas fa-chart-line"></i> Prism Dashboard
            </div>
            <div class="search-container">
                <input 
                    type="text" 
                    class="search-input" 
                    placeholder="输入股票代码..."
                    id="stockInput"
                    maxlength="6"
                    pattern="[0-9]{6}"
                >
                <button class="search-btn" onclick="loadStockDashboard()">
                    <i class="fas fa-search"></i>
                </button>
            </div>
        </div>
        <div class="header-right">
            <div id="lastUpdate" style="font-size: 0.9rem; opacity: 0.8;">
                等待数据加载...
            </div>
            <button class="refresh-btn" onclick="refreshDashboard()">
                <i class="fas fa-sync-alt"></i> 刷新
            </button>
        </div>
    </div>

    <div class="container">
        <!-- Main Dashboard Grid -->
        <div class="dashboard-grid">
            <!-- Price Card -->
            <div class="dashboard-card price-card">
                <div class="card-title">
                    <i class="fas fa-dollar-sign"></i>
                    实时价格 <span id="stockName">(请输入股票代码)</span>
                </div>
                <div class="price-main">
                    <div class="current-price" id="currentPrice">--</div>
                    <div class="price-change">
                        <div class="change-value" id="priceChange">--</div>
                        <div class="change-percent" id="priceChangePercent">--%</div>
                    </div>
                </div>
                <div class="chart-container">
                    <canvas id="priceChart"></canvas>
                </div>
            </div>

            <!-- Market Cap -->
            <div class="dashboard-card kpi-card market-cap-card">
                <div class="card-title">
                    <i class="fas fa-building"></i>
                    总市值
                </div>
                <div class="kpi-value" id="marketCap">--</div>
                <div class="kpi-label">亿元</div>
                <div class="kpi-change" id="marketCapChange">--</div>
            </div>

            <!-- Volume Ratio -->
            <div class="dashboard-card kpi-card volume-ratio-card">
                <div class="card-title">
                    <i class="fas fa-chart-bar"></i>
                    量比
                </div>
                <div class="kpi-value" id="volumeRatio">--</div>
                <div class="kpi-label">倍</div>
                <div class="kpi-change" id="volumeStatus">--</div>
            </div>

            <!-- Volume Analysis -->
            <div class="dashboard-card volume-card">
                <div class="card-title">
                    <i class="fas fa-chart-area"></i>
                    成交量分析
                </div>
                <div class="chart-container">
                    <div id="volumeChart"></div>
                </div>
            </div>

            <!-- Sentiment -->
            <div class="dashboard-card kpi-card sentiment-card">
                <div class="card-title">
                    <i class="fas fa-heart"></i>
                    市场情绪
                </div>
                <div class="kpi-value" id="sentimentScore">--</div>
                <div class="kpi-label">分</div>
                <div class="kpi-change" id="sentimentStatus">--</div>
            </div>

            <!-- Technical Analysis -->
            <div class="dashboard-card technical-card">
                <div class="card-title">
                    <i class="fas fa-chart-line"></i>
                    技术指标
                </div>
                <div class="chart-container">
                    <canvas id="technicalChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Financial Performance -->
        <div class="financial-grid">
            <div class="dashboard-card revenue-card">
                <div class="card-title">
                    <i class="fas fa-trending-up"></i>
                    营业收入趋势
                </div>
                <div class="chart-container chart-large">
                    <div id="revenueChart"></div>
                </div>
            </div>

            <div class="dashboard-card profit-card">
                <div class="card-title">
                    <i class="fas fa-coins"></i>
                    净利润趋势
                </div>
                <div class="chart-container chart-large">
                    <div id="profitChart"></div>
                </div>
            </div>
        </div>

        <!-- AI Analysis -->
        <div class="ai-analysis">
            <div class="ai-card ai-professional" id="professionalAnalysis">
                <div class="card-title">
                    <i class="fas fa-user-tie"></i>
                    资深分析师观点
                </div>
                <div class="loading" id="professionalLoading">
                    <div class="spinner"></div>
                    AI分析师正在分析中...
                </div>
                <div id="professionalContent" style="display: none;">
                    <!-- AI content will be inserted here -->
                </div>
            </div>

            <div class="ai-card ai-dark" id="darkAnalysis">
                <div class="card-title">
                    <i class="fas fa-user-ninja"></i>
                    暗黑评论员观点
                </div>
                <div class="loading" id="darkLoading">
                    <div class="spinner"></div>
                    AI评论员正在分析中...
                </div>
                <div id="darkContent" style="display: none;">
                    <!-- AI content will be inserted here -->
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentStockCode = '';
        let priceChart, technicalChart;
        let volumeEChart, revenueEChart, profitEChart;

        // 初始化图表
        function initCharts() {
            // Price Chart (Chart.js)
            const priceCtx = document.getElementById('priceChart').getContext('2d');
            priceChart = new Chart(priceCtx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: '股价',
                        data: [],
                        borderColor: '#2a5298',
                        backgroundColor: 'rgba(42, 82, 152, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: false,
                            grid: {
                                color: '#f0f0f0'
                            }
                        },
                        x: {
                            grid: {
                                color: '#f0f0f0'
                            }
                        }
                    }
                }
            });

            // Technical Chart (Chart.js)
            const techCtx = document.getElementById('technicalChart').getContext('2d');
            technicalChart = new Chart(techCtx, {
                type: 'doughnut',
                data: {
                    labels: ['RSI', 'MACD', 'MA5', 'MA20'],
                    datasets: [{
                        data: [0, 0, 0, 0],
                        backgroundColor: [
                            '#16c784',
                            '#ea3943',
                            '#ffc107',
                            '#2a5298'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });

            // ECharts初始化
            volumeEChart = echarts.init(document.getElementById('volumeChart'));
            revenueEChart = echarts.init(document.getElementById('revenueChart'));
            profitEChart = echarts.init(document.getElementById('profitChart'));

            // 初始化ECharts配置
            updateVolumeChart([]);
            updateFinancialCharts({}, {});
        }

        // 加载股票仪表盘
        async function loadStockDashboard() {
            const stockCode = document.getElementById('stockInput').value.trim();
            
            if (!/^\d{6}$/.test(stockCode)) {
                alert('请输入正确的6位股票代码');
                return;
            }

            currentStockCode = stockCode;
            showLoading();

            try {
                // 获取股票数据
                const response = await fetch(`http://35.77.54.203:3006/api/stocks/${stockCode}/data`);
                const stockData = await response.json();

                // 更新仪表盘
                updateDashboard(stockData);

                // 启动AI分析
                startAIAnalysis(stockCode);

                document.getElementById('lastUpdate').textContent = `最后更新: ${new Date().toLocaleString()}`;

            } catch (error) {
                console.error('Error:', error);
                showError('数据加载失败，请检查网络连接');
            }
        }

        // 更新仪表盘数据
        function updateDashboard(stockData) {
            const { fundamental, technical, financial, sentiment } = stockData;

            // 更新股票名称和价格
            document.getElementById('stockName').textContent = `(${fundamental.stock_name})`;
            document.getElementById('currentPrice').textContent = `¥${technical.current_price || fundamental.current_price}`;

            // 更新价格变化
            const priceChange = technical.price_change || 0;
            const priceChangePct = technical.price_change_pct || 0;
            
            document.getElementById('priceChange').textContent = `${priceChange > 0 ? '+' : ''}¥${priceChange.toFixed(2)}`;
            document.getElementById('priceChangePercent').textContent = `${priceChange > 0 ? '+' : ''}${priceChangePct.toFixed(2)}%`;

            const changeElements = ['priceChange', 'priceChangePercent'];
            const colorClass = priceChangePct >= 0 ? 'price-positive' : 'price-negative';
            changeElements.forEach(id => {
                document.getElementById(id).className = `change-value ${colorClass}`;
            });

            // 更新KPI
            document.getElementById('marketCap').textContent = (fundamental.market_cap / 100000000).toFixed(0);
            document.getElementById('volumeRatio').textContent = (technical.volume_ratio || 0).toFixed(2);
            document.getElementById('sentimentScore').textContent = Math.round(sentiment.sentiment_score * 100);

            // 更新状态
            const volumeStatus = technical.volume_ratio > 1.5 ? '放量' : technical.volume_ratio < 0.8 ? '缩量' : '正常';
            document.getElementById('volumeStatus').innerHTML = `<span class="status-indicator ${volumeStatus === '放量' ? 'status-positive' : volumeStatus === '缩量' ? 'status-negative' : 'status-neutral'}">${volumeStatus}</span>`;
            
            document.getElementById('sentimentStatus').innerHTML = `<span class="status-indicator ${sentiment.news_sentiment === 'positive' ? 'status-positive' : sentiment.news_sentiment === 'negative' ? 'status-negative' : 'status-neutral'}">${sentiment.market_mood}</span>`;

            // 更新图表
            updatePriceChart(technical);
            updateVolumeChart(technical);
            updateFinancialCharts(financial.revenue_data, financial.profit_data);
        }

        // 更新价格图表
        function updatePriceChart(technicalData) {
            // 模拟最近30天的价格数据
            const dates = [];
            const prices = [];
            const basePrice = technicalData.current_price || 10;

            for (let i = 29; i >= 0; i--) {
                const date = new Date();
                date.setDate(date.getDate() - i);
                dates.push(date.toLocaleDateString());
                
                // 模拟价格波动
                const randomChange = (Math.random() - 0.5) * 0.1;
                prices.push(basePrice * (1 + randomChange));
            }

            priceChart.data.labels = dates;
            priceChart.data.datasets[0].data = prices;
            priceChart.update();
        }

        // 更新成交量图表
        function updateVolumeChart(technicalData) {
            const option = {
                title: {
                    text: '成交量 & 换手率',
                    left: 'center',
                    textStyle: {
                        fontSize: 14,
                        color: '#333'
                    }
                },
                tooltip: {
                    trigger: 'axis'
                },
                legend: {
                    bottom: 10
                },
                xAxis: {
                    type: 'category',
                    data: ['周一', '周二', '周三', '周四', '周五']
                },
                yAxis: [{
                    type: 'value',
                    name: '成交量(万)',
                    position: 'left'
                }, {
                    type: 'value',
                    name: '换手率(%)',
                    position: 'right'
                }],
                series: [{
                    name: '成交量',
                    type: 'bar',
                    data: [120, 200, 150, 80, 70],
                    itemStyle: {
                        color: '#2a5298'
                    }
                }, {
                    name: '换手率',
                    type: 'line',
                    yAxisIndex: 1,
                    data: [2.0, 3.2, 2.8, 1.5, 1.2],
                    itemStyle: {
                        color: '#16c784'
                    }
                }]
            };

            volumeEChart.setOption(option);
        }

        // 更新财务图表
        function updateFinancialCharts(revenueData, profitData) {
            // 营收图表
            const revenueQuarters = Object.keys(revenueData).sort();
            const revenueValues = revenueQuarters.map(q => (revenueData[q] / 100000000).toFixed(2));

            const revenueOption = {
                title: {
                    text: '营业收入趋势',
                    left: 'center',
                    textStyle: {
                        fontSize: 14
                    }
                },
                tooltip: {
                    trigger: 'axis',
                    formatter: '{b}: {c}亿元'
                },
                xAxis: {
                    type: 'category',
                    data: revenueQuarters.map(q => q.substr(0, 4) + 'Q' + Math.ceil(parseInt(q.substr(4, 2)) / 3))
                },
                yAxis: {
                    type: 'value',
                    name: '收入(亿元)'
                },
                series: [{
                    data: revenueValues,
                    type: 'line',
                    smooth: true,
                    itemStyle: {
                        color: '#2a5298'
                    },
                    areaStyle: {
                        color: 'rgba(42, 82, 152, 0.1)'
                    }
                }]
            };

            // 利润图表
            const profitQuarters = Object.keys(profitData).sort();
            const profitValues = profitQuarters.map(q => (profitData[q] / 100000000).toFixed(2));

            const profitOption = {
                title: {
                    text: '净利润趋势',
                    left: 'center',
                    textStyle: {
                        fontSize: 14
                    }
                },
                tooltip: {
                    trigger: 'axis',
                    formatter: '{b}: {c}亿元'
                },
                xAxis: {
                    type: 'category',
                    data: profitQuarters.map(q => q.substr(0, 4) + 'Q' + Math.ceil(parseInt(q.substr(4, 2)) / 3))
                },
                yAxis: {
                    type: 'value',
                    name: '利润(亿元)'
                },
                series: [{
                    data: profitValues,
                    type: 'bar',
                    itemStyle: {
                        color: '#16c784'
                    }
                }]
            };

            revenueEChart.setOption(revenueOption);
            profitEChart.setOption(profitOption);
        }

        // 启动AI分析
        async function startAIAnalysis(stockCode) {
            try {
                const response = await fetch('http://35.77.54.203:3006/api/generate-articles', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        stock_code: stockCode,
                        article_styles: ['professional', 'dark']
                    })
                });

                const data = await response.json();
                
                if (response.ok) {
                    pollAIResults(data.task_id);
                }
            } catch (error) {
                console.error('AI analysis error:', error);
                showAIError();
            }
        }

        // 轮询AI结果
        async function pollAIResults(taskId) {
            try {
                const response = await fetch(`http://35.77.54.203:3006/api/tasks/${taskId}`);
                const data = await response.json();

                if (data.status === 'completed' && data.articles) {
                    displayAIAnalysis(data.articles);
                } else if (data.status === 'failed') {
                    showAIError();
                } else {
                    setTimeout(() => pollAIResults(taskId), 2000);
                }
            } catch (error) {
                console.error('Polling error:', error);
                showAIError();
            }
        }

        // 显示AI分析结果
        function displayAIAnalysis(articles) {
            articles.forEach(article => {
                const contentId = article.style === 'professional' ? 'professionalContent' : 'darkContent';
                const loadingId = article.style === 'professional' ? 'professionalLoading' : 'darkLoading';

                document.getElementById(loadingId).style.display = 'none';
                document.getElementById(contentId).style.display = 'block';
                document.getElementById(contentId).innerHTML = `
                    <div class="ai-header">
                        <div class="ai-avatar">
                            <i class="fas ${article.style === 'professional' ? 'fa-user-tie' : 'fa-user-ninja'}"></i>
                        </div>
                        <div>
                            <h3>${article.style === 'professional' ? '资深分析师' : '暗黑评论员'}</h3>
                            <div style="font-size: 0.9rem; opacity: 0.8;">置信度: ${Math.round(article.confidence_score * 100)}%</div>
                        </div>
                    </div>
                    <h4>${article.title}</h4>
                    <div class="ai-content">${article.content}</div>
                    <div class="ai-summary">${article.summary}</div>
                `;
            });
        }

        // 显示加载状态
        function showLoading() {
            // 重置所有数值
            ['currentPrice', 'priceChange', 'priceChangePercent', 'marketCap', 'volumeRatio', 'sentimentScore'].forEach(id => {
                document.getElementById(id).textContent = '--';
            });

            ['volumeStatus', 'sentimentStatus'].forEach(id => {
                document.getElementById(id).textContent = '加载中...';
            });
        }

        // 显示错误
        function showError(message) {
            alert(message);
        }

        // 显示AI错误
        function showAIError() {
            ['professionalContent', 'darkContent'].forEach(id => {
                document.getElementById(id).innerHTML = '<div class="error-card"><i class="fas fa-exclamation-triangle error-icon"></i><p>AI分析暂时不可用</p></div>';
                document.getElementById(id).style.display = 'block';
            });

            ['professionalLoading', 'darkLoading'].forEach(id => {
                document.getElementById(id).style.display = 'none';
            });
        }

        // 刷新仪表盘
        function refreshDashboard() {
            if (currentStockCode) {
                loadStockDashboard();
            }
        }

        // 回车搜索
        document.getElementById('stockInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                loadStockDashboard();
            }
        });

        // 输入验证
        document.getElementById('stockInput').addEventListener('input', function(e) {
            this.value = this.value.replace(/[^0-9]/g, '').slice(0, 6);
        });

        // 页面加载完成后初始化
        window.addEventListener('load', function() {
            initCharts();
            
            // 窗口大小改变时重新渲染ECharts
            window.addEventListener('resize', function() {
                if (volumeEChart) volumeEChart.resize();
                if (revenueEChart) revenueEChart.resize();
                if (profitEChart) profitEChart.resize();
            });
        });
    </script>
</body>
</html>